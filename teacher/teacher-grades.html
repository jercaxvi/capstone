<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grades - Sto. Niño National High School</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/teacher-common.css" />
  <link rel="stylesheet" href="css/teacher-sidebar.css" />
  <link rel="stylesheet" href="css/teacher-grades.css" />
</head>
<body>
  <div class="sidebar">
    <div class="logo-container">
      <img src="../images/logo.jpg" alt="School Logo">
    </div>
    <ul>
      <li>
        <a href="teacher-dashboard.html">
          <span class="icon">
            <!-- Info icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          </span>
          Announcements
        </a>
      </li>
      <li>
        <a href="teacher-classes.html">
          <span class="icon">
            <!-- User icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg>
          </span>
          Classes
        </a>
      </li>
      <li class="active">
        <a href="teacher-grades.html">
          <span class="icon">
            <!-- Bar chart icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="4" y1="12" x2="4" y2="20"/><line x1="12" y1="8" x2="12" y2="20"/><line x1="20" y1="4" x2="20" y2="20"/></svg>
          </span>
          Grades
        </a>
      </li>
      <li>
        <a href="teacher-subject.html">
          <span class="icon">
            <!-- Outlined book icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="16" rx="2"/><path d="M16 2v4"/><path d="M8 2v4"/><line x1="3" y1="8" x2="21" y2="8"/></svg>
          </span>
          Subjects
        </a>
      </li>
      <li>
        <a href="teacher-masterlist.html">
          <span class="icon">
            <!-- List icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><circle cx="3" cy="6" r="1"/><circle cx="3" cy="12" r="1"/><circle cx="3" cy="18" r="1"/></svg>
          </span>
          Masterlist
        </a>
      </li>
      <li>
        <a href="teacher-message.html">
          <span class="icon">
            <!-- Mail icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg>
          </span>
          Messages
        </a>
      </li>
      <li>
        <a href="teacher-profile.html">
          <span class="icon">
            <!-- Home icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7"/><path d="M9 22V12h6v10"/></svg>
          </span>
          Profile
        </a>
      </li>
      <li>
        <a href="teacher-help.html">
          <span class="icon">
            <!-- Info icon (help) -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          </span>
          Help
        </a>
      </li>
    </ul>
  </div>
  <div class="top-header">
    <div class="school-name">Sto. Niño National High School</div>
    <div class="header-controls">
      <div class="notifications">
        <span class="icon">
          <svg width="24" height="24" fill="none" stroke="#636e72" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        </span>
        <span class="badge">2</span>
      </div>
      <div class="user-controls">
        <div class="user-info">
          <div class="user-name">Angelica Nanas</div>
          <div class="user-role">Science Teacher</div>
        </div>
        <div class="user-avatar">
          <img src="https://cdn-icons-png.flaticon.com/128/3135/3135715.png" alt="User Avatar">
        </div>
        <button class="logout-btn">Logout</button>
      </div>
    </div>
  </div>
  <style>
    .auth-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .auth-modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
    .auth-modal h3 {
      color: #276749;
      margin: 0 0 1.5rem 0;
      font-size: 1.4rem;
    }
    .auth-modal input {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid #a1c8b8;
      border-radius: 8px;
      font-size: 1.1rem;
      margin-bottom: 1.5rem;
      outline: none;
    }
    .auth-modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }
    .auth-modal button {
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .auth-modal .cancel-btn {
      border: 2px solid #a1c8b8;
      background: none;
      color: #276749;
    }
    .auth-modal .submit-btn {
      background: #277759;
      color: white;
      border: none;
    }
    /* Grade input modal styles */
    .grade-input-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1100;
      justify-content: center;
      align-items: center;
    }
    .grade-input-modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .grade-input-modal h3 {
      color: #276749;
      margin: 0 0 1.5rem 0;
      font-size: 1.4rem;
    }
    .grade-input-modal input, .grade-input-modal textarea {
      width: 100%;
      padding: 0.8rem;
      border: 2px solid #a1c8b8;
      border-radius: 8px;
      font-size: 1.1rem;
      margin-bottom: 1.1rem;
      outline: none;
      resize: none;
    }
    .grade-input-modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }
    .grade-input-modal button {
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .grade-input-modal .cancel-btn {
      border: 2px solid #a1c8b8;
      background: none;
      color: #276749;
    }
    .grade-input-modal .submit-btn {
      background: #277759;
      color: white;
      border: none;
    }
    .confirmation-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1200;
      justify-content: center;
      align-items: center;
    }
    .confirmation-modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      text-align: center;
    }
    .confirmation-modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.5rem;
    }
    .confirmation-modal button {
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .confirmation-modal .cancel-btn {
      border: 2px solid #a1c8b8;
      background: none;
      color: #276749;
    }
    .confirmation-modal .confirm-btn {
      background: #277759;
      color: white;
      border: none;
    }
    .success-toast {
      display: none;
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      background: #277759;
      color: #fff;
      padding: 1rem 2rem;
      border-radius: 8px;
      font-size: 1.1rem;
      z-index: 1300;
      box-shadow: 0 2px 8px rgba(44,62,80,0.10);
      animation: fadeInOut 2.5s;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { opacity: 0; }
    }
  </style>

  <div class="main-content" style="background: #e6f0ea; min-height: 100vh;">
    <!-- Auth Modal -->
    <div id="authModal" class="auth-modal">
      <div class="auth-modal-content">
        <h3>Enter Password</h3>
        <input type="password" id="passwordInput" placeholder="Enter password">
        <div class="auth-modal-buttons">
          <button class="cancel-btn" onclick="closeAuthModal()">Cancel</button>
          <button class="submit-btn" onclick="submitPassword()">Submit</button>
        </div>
      </div>
    </div>
    <!-- Grade Input Modal -->
    <div id="gradeInputModal" class="grade-input-modal">
      <div class="grade-input-modal-content">
        <img src="../images/logo.jpg" alt="School Logo" style="width:60px;display:block;margin:0 auto 1rem auto;border-radius:12px;box-shadow:0 2px 8px rgba(44,62,80,0.10);">
        <div style="text-align:center;margin-bottom:1.1rem;">
          <div style="font-weight:700;font-size:1.15rem;color:#276749;">Student Information</div>
          <div id="studentInfoInput" style="font-size:1.05rem;color:#184d27;"></div>
        </div>
        <h3 style="font-size:1.05rem;font-weight:600;">Insert Grade for <span id="gradeStudentName"></span></h3>
        <input type="number" id="gradeInput" placeholder="Enter grade (60-100) or leave blank" min="60" max="100">
        <textarea id="gradeComment" placeholder="Add a comment (optional)" rows="2"></textarea>
        <div id="gradeInputError" style="color:#c53030; font-size:1rem; min-height:1.5em; margin-bottom:0.5em;"></div>
        <div class="grade-input-modal-buttons">
          <button class="cancel-btn" onclick="closeGradeInputModal()">Cancel</button>
          <button class="submit-btn" onclick="openConfirmationModal()">Submit</button>
        </div>
      </div>
    </div>
    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="confirmation-modal">
      <div class="confirmation-modal-content">
        <img src="../images/logo.jpg" alt="School Logo" style="width:60px;display:block;margin:0 auto 1rem auto;border-radius:12px;box-shadow:0 2px 8px rgba(44,62,80,0.10);">
        <div style="text-align:center;margin-bottom:1.1rem;">
          <div style="font-weight:700;font-size:1.15rem;color:#276749;">Student Information</div>
          <div id="studentInfoConfirm" style="font-size:1.05rem;color:#184d27;"></div>
        </div>
        <div id="confirmationSummary"></div>
        <div class="confirmation-modal-buttons">
          <button class="cancel-btn" onclick="closeConfirmationModal()">Cancel</button>
          <button class="confirm-btn" onclick="submitGrade()">Confirm</button>
        </div>
      </div>
    </div>
    <!-- Success Toast -->
    <div id="successToast" class="success-toast"></div>

    <h1 id="gradesTitle" style="color: #276749; font-size: 2rem; font-weight: 700; margin-bottom: 1.5rem;">Grades - Grade 7</h1>
    <div class="section-select" style="margin-bottom: 1.25rem; max-width: 350px;">
      <select id="sectionSelect" style="width:100%; padding:0.7rem 1rem; border-radius:8px; border:1.5px solid #a1c8b8; color:#276749; font-size:1.08rem; font-weight:600; background:#f4fbf7;">
        <option value="g7-dahlia">Grade 7 - Dahlia</option>
        <option value="g8-lilac">Grade 8 - Lilac</option>
        <option value="g8-tulip">Grade 8 - Tulip</option>
        <option value="g9-daisy">Grade 9 - Daisy</option>
      </select>
    </div>
    <div class="grades-card" style="background: #fff; border-radius: 18px; box-shadow: 0 2px 12px rgba(44,62,80,0.07); padding: 0; max-width: 100%; margin: 0 auto;">
      <div class="grades-tabs" style="display: flex; align-items: center; background: #4c7a67; border-radius: 18px 18px 0 0;">
        <button class="grades-tab active" data-tab="q1" style="flex:1; background:none; border:none; color:#a1c8b8; font-size:1.15rem; font-weight:600; padding:1.1rem 0; border-radius:18px 18px 0 0; cursor:pointer;">First Quarter</button>
        <button class="grades-tab" data-tab="q2" style="flex:1; background:none; border:none; color:#fff; font-size:1.15rem; font-weight:600; padding:1.1rem 0; border-radius:18px 18px 0 0; cursor:pointer;">Second Quarter</button>
        <button class="grades-tab" data-tab="q3" style="flex:1; background:none; border:none; color:#fff; font-size:1.15rem; font-weight:600; padding:1.1rem 0; border-radius:18px 18px 0 0; cursor:pointer;">Third Quarter</button>
        <button class="grades-tab" data-tab="q4" style="flex:1; background:none; border:none; color:#fff; font-size:1.15rem; font-weight:600; padding:1.1rem 0; border-radius:18px 18px 0 0; cursor:pointer;">Fourth Quarter</button>
        <div style="flex:2; text-align:right; padding:0 2rem;">
          <input id="grades-search" type="text" placeholder="Search..." style="background:none; border:none; border-bottom:2px solid #fff; color:#fff; font-size:1.1rem; padding:0.5rem 0; outline:none; width: 200px; max-width: 100%;">
        </div>
      </div>
      <div class="grades-table-container" style="overflow-x:auto;">
        <table class="grades-table" style="width:100%; border-collapse:collapse;">
          <thead>
            <tr style="background:#f4fbf7;">
              <th style="padding:1rem 0.5rem; text-align:center;">Grade</th>
              <th style="padding:1rem 0.5rem;">Subject</th>
              <th style="padding:1rem 0.5rem;">Name</th>
              <th style="padding:1rem 0.5rem;">Status</th>
              <th style="padding:1rem 0.5rem;">LRN</th>
              <th style="padding:1rem 0.5rem;">Final Grade</th>
              <th style="padding:1rem 0.5rem;">Edit Grades</th>
            </tr>
          </thead>
          <tbody id="grades-tbody">
            <!-- JS will render rows here -->
          </tbody>
        </table>
      </div>
    </div>
    <script>
      // Sample students for each section
      const studentsBySection = {
        'g7-dahlia': [
          { grade: 7, name: 'Kiana Mae Alvarez', status: '', lrn: '00000001', final: null },
          { grade: 7, name: 'Jerica May Galve', status: '', lrn: '00000002', final: null },
          { grade: 7, name: 'Haven Joy Dayola', status: '', lrn: '00000003', final: null },
          { grade: 7, name: 'Khaleed James Forteza', status: '', lrn: '00000004', final: null },
          { grade: 7, name: 'Jandel Grower', status: '', lrn: '00000005', final: null },
        ],
        'g8-lilac': [
          { grade: 8, name: 'Maria Santos', status: '', lrn: '00000006', final: null },
          { grade: 8, name: 'John Dela Cruz', status: '', lrn: '00000007', final: null },
          { grade: 8, name: 'Sarah Johnson', status: '', lrn: '00000008', final: null },
          { grade: 8, name: 'Michael Tan', status: '', lrn: '00000009', final: null },
          { grade: 8, name: 'Lisa Wong', status: '', lrn: '00000010', final: null },
        ],
        'g8-tulip': [
          { grade: 8, name: 'David Lee', status: '', lrn: '00000011', final: null },
          { grade: 8, name: 'Anna Garcia', status: '', lrn: '00000012', final: null },
          { grade: 8, name: 'Robert Chen', status: '', lrn: '00000013', final: null },
          { grade: 8, name: 'Emily Martinez', status: '', lrn: '00000014', final: null },
          { grade: 8, name: 'James Wilson', status: '', lrn: '00000015', final: null },
        ],
        'g9-daisy': [
          { grade: 9, name: 'Sophia Kim', status: '', lrn: '00000016', final: null },
          { grade: 9, name: 'Daniel Park', status: '', lrn: '00000017', final: null },
          { grade: 9, name: 'Olivia Brown', status: '', lrn: '00000018', final: null },
          { grade: 9, name: 'William Davis', status: '', lrn: '00000019', final: null },
          { grade: 9, name: 'Emma Taylor', status: '', lrn: '00000020', final: null },
        ],
      };

      // Function to clone students for each quarter
      function cloneStudents(students) {
        return students.map(s => ({ ...s }));
      }

      // Initialize gradesData with students from the default section
      let gradesData = {};
      function setGradesDataForSection(sectionKey) {
        const students = studentsBySection[sectionKey] || [];
        gradesData = {
          q1: cloneStudents(students),
          q2: cloneStudents(students),
          q3: cloneStudents(students),
          q4: cloneStudents(students),
        };
      }

      // Get initial section from dropdown
      const sectionSelect = document.getElementById('sectionSelect');
      let currentSection = sectionSelect.value;
      setGradesDataForSection(currentSection);

      // Update gradesData and re-render when section changes
      sectionSelect.addEventListener('change', function() {
        currentSection = this.value;
        setGradesDataForSection(currentSection);
        // Update the title
        const selectedText = this.options[this.selectedIndex].text;
        document.getElementById('gradesTitle').textContent = 'Grades - ' + selectedText;
        renderGradesTab(currentTab, document.getElementById('grades-search').value);
      });

      // Set initial title
      document.getElementById('gradesTitle').textContent = 'Grades - ' + sectionSelect.options[sectionSelect.selectedIndex].text;

      function renderGradesTab(tab, search = '') {
        const tbody = document.getElementById('grades-tbody');
        const container = document.querySelector('.grades-table-container');
        
        // Add fade out effect
        container.classList.add('fade-out');
        
        setTimeout(() => {
          tbody.innerHTML = '';
          gradesData[tab]
            .filter(row => row.name.toLowerCase().includes(search.toLowerCase()))
            .forEach(row => {
              tbody.innerHTML += `
                <tr style="background:${row.status==='INCOMPLETE'||row.status==='FAILED'?'#f8fafc':''};">
                  <td style="text-align:center;">${row.grade}</td>
                  <td style="text-align:center;">Math</td>
                  <td>${row.name}</td>
                  <td${row.status ? ` style=\"font-weight:700;${row.status==='PASSED'?'color:#184d27;':row.status==='FAILED'?'color:#c53030;':''}\"` : ''}>${row.status || ''}</td>
                  <td>${row.lrn}</td>
                  <td>${row.final !== null ? row.final : '-'}</td>
                  <td><button onclick="authenticateView('${row.name}')" style="background:#277759;color:#fff;border:none;border-radius:2rem;padding:0.6rem 2.2rem;font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:0.5rem;cursor:pointer;"><svg width="20" height="20" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4"/><line x1="21" y1="12" x2="17" y2="12"/></svg>view</button></td>
                </tr>
              `;
            });
          
          // Add fade in effect
          container.classList.remove('fade-out');
          container.classList.add('fade-in');
        }, 150);
      }

      let currentStudentName = '';
      let currentTab = 'q1';
      let pendingGrade = null;
      let pendingComment = '';

      function authenticateView(studentName) {
        currentStudentName = studentName;
        // Find student info
        const student = gradesData[currentTab].find(row => row.name === currentStudentName);
        let infoHtml = '';
        if (student) {
          infoHtml = `Name: <b>${student.name}</b><br>LRN: <b>${student.lrn}</b><br>Grade: <b>${student.grade}</b>`;
        }
        document.getElementById('studentInfoInput').innerHTML = infoHtml;
        document.getElementById('gradeStudentName').textContent = currentStudentName;
        document.getElementById('gradeInput').value = '';
        document.getElementById('gradeComment').value = '';
        document.getElementById('gradeInputError').textContent = '';
        document.getElementById('gradeInputModal').style.display = 'flex';
        document.getElementById('gradeInput').focus();
      }

      function closeAuthModal() {
        const modal = document.getElementById('authModal');
        modal.style.display = 'none';
      }

      function submitPassword() {
        const password = document.getElementById('passwordInput').value;
        if (password === '12345') {
          alert('Password correct!');
          closeAuthModal();
          // Show grade input modal
          document.getElementById('gradeStudentName').textContent = currentStudentName;
          document.getElementById('gradeInput').value = '';
          document.getElementById('gradeComment').value = '';
          document.getElementById('gradeInputError').textContent = '';
          document.getElementById('gradeInputModal').style.display = 'flex';
          document.getElementById('gradeInput').focus();
          // Set status to blank for this student
          const student = gradesData[currentTab].find(row => row.name === currentStudentName);
          if (student) {
            student.status = '';
            student.final = null;
            renderGradesTab(currentTab, document.getElementById('grades-search').value);
          }
        } else {
          alert('Incorrect password. Access denied.');
          document.getElementById('passwordInput').value = '';
          document.getElementById('passwordInput').focus();
        }
      }

      function closeGradeInputModal() {
        document.getElementById('gradeInputModal').style.display = 'none';
      }

      function openConfirmationModal() {
        const gradeValue = document.getElementById('gradeInput').value;
        const commentValue = document.getElementById('gradeComment').value;
        const errorDiv = document.getElementById('gradeInputError');
        if (gradeValue === '') {
          pendingGrade = '';
          pendingComment = commentValue;
        } else {
          const gradeNum = parseInt(gradeValue);
          if (isNaN(gradeNum) || gradeNum < 60 || gradeNum > 100) {
            errorDiv.textContent = 'Please enter a grade between 60 and 100.';
            document.getElementById('gradeInput').focus();
            return;
          }
          pendingGrade = gradeNum;
          pendingComment = commentValue;
        }
        // Determine status
        let status = '';
        if (gradeValue === '') {
          status = '';
        } else if (pendingGrade >= 75) {
          status = 'PASSED';
        } else if (pendingGrade >= 60 && pendingGrade <= 74) {
          status = 'FAILED';
        }
        // Find student info
        const student = gradesData[currentTab].find(row => row.name === currentStudentName);
        let infoHtml = '';
        if (student) {
          infoHtml = `Name: <b>${student.name}</b><br>LRN: <b>${student.lrn}</b><br>Grade: <b>${student.grade}</b>`;
        }
        document.getElementById('studentInfoConfirm').innerHTML = infoHtml;
        // Show confirmation summary
        document.getElementById('confirmationSummary').innerHTML =
          `<div style='font-size:1.1rem;margin-bottom:1.2rem;'>You are about to post grade <b>${gradeValue || '-'}</b> <span style='color:${status==='PASSED'?'#184d27':status==='FAILED'?'color:#c53030;':''};font-weight:700;'>${status || ''}</span> for <b>${currentStudentName}</b>.<br>${pendingComment ? 'Comment: <i>' + pendingComment + '</i>' : ''}<br>Proceed?</div>`;
        document.getElementById('confirmationModal').style.display = 'flex';
      }

      function closeConfirmationModal() {
        document.getElementById('confirmationModal').style.display = 'none';
      }

      function submitGrade() {
        // Find the student in the current tab's data
        const student = gradesData[currentTab].find(row => row.name === currentStudentName);
        if (student) {
          if (pendingGrade === '') {
            student.final = null;
            student.status = '';
            student.comment = pendingComment;
          } else if (pendingGrade >= 75) {
            student.final = pendingGrade;
            student.status = 'PASSED';
            student.comment = pendingComment;
          } else if (pendingGrade >= 60 && pendingGrade <= 74) {
            student.final = pendingGrade;
            student.status = 'FAILED';
            student.comment = pendingComment;
          }
        }
        closeConfirmationModal();
        closeGradeInputModal();
        showSuccessToast(`Grade posted successfully for ${currentStudentName}.`);
        renderGradesTab(currentTab, document.getElementById('grades-search').value);
      }

      function showSuccessToast(message) {
        const toast = document.getElementById('successToast');
        toast.textContent = message;
        toast.style.display = 'block';
        setTimeout(() => {
          toast.style.display = 'none';
        }, 2200);
      }

      // Add event listener for Enter key in grade input modal
      document.getElementById('gradeInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          openConfirmationModal();
        }
      });
      document.getElementById('gradeComment').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          openConfirmationModal();
        }
      });
      // Close modal when clicking outside
      document.getElementById('gradeInputModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeGradeInputModal();
        }
      });
      document.getElementById('confirmationModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeConfirmationModal();
        }
      });
      // Tab switching
      document.querySelectorAll('.grades-tab').forEach(tabBtn => {
        tabBtn.addEventListener('click', function() {
          document.querySelectorAll('.grades-tab').forEach(btn => {
            btn.classList.remove('active');
            btn.style.color = '#fff';
          });
          this.classList.add('active');
          this.style.color = '#a1c8b8';
          currentTab = this.dataset.tab;
          renderGradesTab(currentTab, document.getElementById('grades-search').value);
        });
      });
      // Search
      document.getElementById('grades-search').addEventListener('input', function() {
        const activeTab = document.querySelector('.grades-tab.active').dataset.tab;
        renderGradesTab(activeTab, this.value);
      });
      // Initial render
      renderGradesTab('q1');

      document.querySelector('.logout-btn').addEventListener('click', function() {
        window.location.href = '../index.html';
      });
    </script>
  </div>
</body>
</html> 