<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Sto. Niño National High School</title>
  <link rel="stylesheet" href="css/admin-dashboard.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  
</head>
<body>
  <div class="sidebar">
    <div class="logo-container">
      <img src="../images/logo.jpg" alt="School Logo">
    </div>
    <ul>
      <li>
        <a href="admin-main.html">
          <span class="icon">
            <!-- Dashboard icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
          </span>
          Dashboard
        </a>
      </li>
      <li class="active">
        <a href="admin-dashboard.html">
          <span class="icon">
            <!-- Info icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          </span>
          Announcements
        </a>
      </li>
      <li>
        <a href="admin-accounts.html">
          <span class="icon">
            <!-- User icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg>
          </span>
          Accounts
        </a>
      </li>
      <li>
        <a href="admin-grades.html">
          <span class="icon">
            <!-- Bar chart icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
          </span>
          Grades
        </a>
      </li>
      <li>
        <a href="admin-subject.html">
          <span class="icon">
            <!-- Book icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M2 19.5A2.5 2.5 0 0 1 4.5 17H20"/><path d="M2 6.5A2.5 2.5 0 0 1 4.5 4H20v16H4.5A2.5 2.5 0 0 1 2 17.5z"/></svg>
          </span>
          Subject
        </a>
      </li>
      <li>
        <a href="admin-schedule.html">
          <span class="icon">
            <!-- Calendar icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </span>
          Schedule
        </a>
      </li>
      <li>
        <a href="admin-enrollment.html">
          <span class="icon">
            <!-- Open book icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M2 7v13a2 2 0 0 0 2 2h14"/><path d="M22 7v13a2 2 0 0 1-2 2H6"/><path d="M2 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2"/><path d="M12 5v16"/></svg>
          </span>
          Enrollment
        </a>
      </li>
      <li>
        <a href="admin-masterlist.html">
          <span class="icon">
            <!-- List icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><circle cx="3" cy="6" r="1"/><circle cx="3" cy="12" r="1"/><circle cx="3" cy="18" r="1"/></svg>
          </span>
          Masterlist
        </a>
      </li>
      <li>
        <a href="admin-notification.html">
          <span class="icon">
            <!-- Bell icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          </span>
          Notifications
        </a>
      </li>
      <li>
        <a href="admin-message.html">
          <span class="icon">
            <!-- Mail icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg>
          </span>
          Messages
        </a>
      </li>
      <li>
        <a href="admin-profile.html">
          <span class="icon">
            <!-- Home icon -->
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7"/><path d="M9 22V12h6v10"/></svg>
          </span>
          Profile
        </a>
      </li>
    </ul>
  </div>
  <div class="top-header">
    <div class="school-name">
      Sto. Niño National High School
    </div>
    <div class="header-controls">
      <div class="notifications">
        <img src="https://cdn-icons-png.flaticon.com/128/3602/3602145.png" alt="Notifications" class="icon">
        <span class="badge">3</span>
      </div>
      <div class="user-controls">
        <div class="user-info">
          <div class="user-name">Erwin Acorda</div>
          <div class="user-role">Administrator</div>
        </div>
        <div class="user-avatar">
          <img src="https://cdn-icons-png.flaticon.com/128/3135/3135715.png" alt="User Avatar">
        </div>
        <button class="logout-btn btn-smart-animate">
          <span>Logout</span>
        </button>
      </div>
    </div>
  </div>
  <div class="main-content" style="display: flex; gap: 2.5rem; align-items: flex-start;">
    <div style="flex: 2; min-width: 0;">
      <div class="announcements-header" style="display: flex; align-items: center; margin-bottom: 0.5rem;">
        <h2 style="margin-right: auto;">Announcements</h2>
      </div>
      <div class="info-cards" style="display: flex; gap: 1.5rem; margin-bottom: 2rem;">
        <div class="info-card">
          <div class="icon">
            <!-- Calendar icon -->
            <svg width="32" height="32" fill="none" stroke="#276749" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          </div>
          <div class="info-title">Events</div>
          <div class="info-number">0</div>
          <div class="info-subtext">Upcoming</div>
        </div>
        <div class="info-card">
          <div class="icon">
            <!-- Viewed icon -->
            <svg width="32" height="32" fill="none" stroke="#276749" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg>
          </div>
          <div class="info-title">Viewed</div>
          <div class="info-number">27</div>
          <div class="info-subtext">Today</div>
        </div>
        <div class="info-card">
          <div class="icon">
            <!-- Unread icon -->
            <svg width="32" height="32" fill="none" stroke="#276749" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg>
          </div>
          <div class="info-title">Unread</div>
          <div class="info-number">6</div>
          <div class="info-subtext">Messages</div>
        </div>
      </div>
      <button class="add-announcement-btn" id="add-announcement-btn" style="margin: 0 0 1.5rem 0;">Add Announcement</button>
      <div class="announcements-list">
        <div class="announcement-card pinned" data-announcement-id="1">
          <div class="announcement-icons">
            <span class="card-pin">
              <!-- Pin icon -->
              <svg width="28" height="28" fill="none" stroke="#f6c23e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M17 3a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2l-7 7v5a1 1 0 0 1-2 0v-5l-7-7a2 2 0 0 0 2-2V5a2 2 0 0 1 2-2h8z"/></svg>
            </span>
            <span class="card-bell">
              <!-- Bell icon -->
              <svg width="28" height="28" fill="none" stroke="#f6c23e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            </span>
          </div>
          <div class="announcement-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div class="announcement-subject">Subject: School Reopening</div>
              <div class="announcement-date">August 1, 2025</div>
              <div class="announcement-sender">From: Admin</div>
            </div>
            <div style="position: relative;">
              <button type="button" class="dots-btn" aria-label="More options">⋮</button>
              <div class="dropdown-menu" style="display: none; position: absolute; right: 0; top: 2rem;">
                <button type="button">View</button><br>
                <button type="button">Edit</button><br>
                <button type="button">Delete</button>
              </div>
            </div>
          </div>
          <div class="announcement-meta">
            <span class="announcement-type general">General</span>
            <span class="announcement-sender">Admin</span>
          </div>
          <div class="announcement-message">
            BANTOT
          </div>
        </div>
        <div class="announcement-card" data-announcement-id="2">
          <div class="announcement-icons">
            <span class="card-bell">
              <!-- Bell icon -->
              <svg width="28" height="28" fill="none" stroke="#f6c23e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            </span>
          </div>
          <div class="announcement-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div class="announcement-subject">New Classroom Assignm</div>
              <div class="announcement-date">June 1, 2025</div>
              <div class="announcement-sender">From: Sir Hermie</div>
            </div>
            <div style="position: relative;">
              <button type="button" class="dots-btn" aria-label="More options">⋮</button>
              <div class="dropdown-menu" style="display: none; position: absolute; right: 0; top: 2rem;">
                <button type="button">View</button><br>
                <button type="button">Edit</button><br>
                <button type="button">Delete</button>
              </div>
            </div>
          </div>
          <div class="announcement-meta">
            <span class="announcement-type message">Message</span>
            <span class="announcement-sender">Sir Hermie</span>
          </div>
          <div class="announcement-message">
            Good day, Admin! Just wanted to ask if the subject materials for my ESP class for grade 7 has been uploaded? I apologize I can't see it on my end.
          </div>
        </div>
        <div class="announcement-card" data-announcement-id="3">
          <div class="announcement-icons">
            <span class="card-bell">
              <!-- Bell icon -->
              <svg width="28" height="28" fill="none" stroke="#f6c23e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            </span>
          </div>
          <div class="announcement-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div class="announcement-subject">IMPORTANT</div>
              <div class="announcement-date">June 1, 2025</div>
              <div class="announcement-sender">From: Sir JP</div>
            </div>
            <div style="position: relative;">
              <button type="button" class="dots-btn" aria-label="More options">⋮</button>
              <div class="dropdown-menu" style="display: none; position: absolute; right: 0; top: 2rem;">
                <button type="button">View</button><br>
                <button type="button">Edit</button><br>
                <button type="button">Delete</button>
              </div>
            </div>
          </div>
          <div class="announcement-meta">
            <span class="announcement-type message">Message</span>
            <span class="announcement-sender">Sir JP</span>
          </div>
          <div class="announcement-message">
            Greetings, Admin! I have a student named James Trio. He said he already passed the soft copy of his form 138. Can you please check whether he passed it already?
          </div>
        </div>
      </div>
    </div>
    <div style="flex: 1; min-width: 280px; max-width: 400px; display: flex; flex-direction: column; align-items: stretch; border-radius: 12px;">
      <div class="location-card" tabindex="0" style="box-shadow: 0 2px 8px rgba(44,62,80,0.07); border-radius: 12px; background: #fff; padding: 1.2rem; font-size: 0.97rem; transition: box-shadow 0.2s, transform 0.2s; cursor: pointer; margin-top: 0; margin-bottom: 1.5rem;">
        <h3 style="text-align:center; color:#fff; background:#184d27; border-radius:6px 6px 0 0; margin:-1.2rem -1.2rem 1rem -1.2rem; padding:0.7rem 0; font-size:1.2rem; font-weight:700; letter-spacing:1px;">LOCATION</h3>
        <div style="width:100%; height:260px; border-radius:8px; overflow:hidden; box-shadow:0 1px 4px rgba(0,0,0,0.08); background:#f8f8f8;">
          <iframe src="https://www.google.com/maps?q=Sto.+Ni%C3%B1o+National+High+School&output=embed" width="100%" height="100%" style="border:0; min-height:240px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
      <div class="mission-card" tabindex="0" style="box-shadow: 0 2px 8px rgba(44,62,80,0.07); border-radius: 12px; background: #fff; padding: 1.2rem; margin-bottom: 1.5rem; font-size: 0.89rem; transition: box-shadow 0.2s, transform 0.2s; cursor: pointer;">
        <h3 style="text-align:center; color:#fff; background:#184d27; border-radius:6px 6px 0 0; margin:-1.2rem -1.2rem 1rem -1.2rem; padding:0.7rem 0; font-size:1.1rem; font-weight:700; letter-spacing:1px;">MISSION</h3>
        <div style="color:#184d27; line-height:1.6; font-size: 0.89rem;">
          <p style="margin-bottom: 0.7rem;">To protect and promote the right of every Filipino to quality, equitable, culture-based, and complete basic education where:</p>
          <div style="margin-bottom: 0.5rem;"><b>Students</b> learn in a child-friendly, gender-sensitive, safe, and motivating environment.</div>
          <div style="margin-bottom: 0.5rem;"><b>Teachers</b> facilitate learning and constantly nurture every learner.</div>
          <div style="margin-bottom: 0.5rem;"><b>Administrators and staff</b>, as stewards of the institution, ensure an enabling and supportive environment for effective learning to happen.</div>
          <div style="margin-bottom: 0.5rem;"><b>Family, community, and other stakeholders</b> are actively engaged and share responsibility for developing life-long learners.</div>
        </div>
      </div>
      <div class="vision-card" tabindex="0" style="box-shadow: 0 2px 8px rgba(44,62,80,0.07); border-radius: 12px; background: #fff; padding: 1.2rem; margin-bottom: 2rem; font-size: 0.89rem; transition: box-shadow 0.2s, transform 0.2s; cursor: pointer;">
        <h3 style="text-align:center; color:#fff; background:#184d27; border-radius:6px 6px 0 0; margin:-1.2rem -1.2rem 1rem -1.2rem; padding:0.7rem 0; font-size:1.1rem; font-weight:700; letter-spacing:1px;">VISION</h3>
        <div style="color:#184d27; line-height:1.6; font-size: 0.89rem; white-space: pre-line;">
We dream of Filipinos
who passionately love their country
and whose values and competencies
enable them to realize their full potential
and contribute meaningfully to building the nation.

As a learner-centered public institution,
the Department of Education
continuously improves itself
to better serve its stakeholders.
        </div>
      </div>
    </div>
  </div>
  <!-- Announcement View/Edit Modal -->
  <div id="announcement-view-edit-modal" class="modal" style="display:none; align-items: center; justify-content: center; position: fixed; z-index: 9999; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(44,62,80,0.18);">
    <div class="modal-content" style="background: #fff; border-radius: 14px; max-width: 700px; width: 95vw; padding: 2rem 1.5rem 1.5rem 1.5rem; position: relative; box-shadow: 0 8px 32px rgba(44,62,80,0.18); max-height: 90vh; overflow-y: auto;">
      <button id="close-view-edit-modal" class="modal-close" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; color: #184d27; cursor: pointer;" onclick="document.getElementById('announcement-view-edit-modal').style.display='none'">&times;</button>
      <h3 id="modal-title" style="margin-bottom: 1.2rem; color: #184d27; font-size: 1.2rem; font-weight: 700; text-align: center;">Announcement Details</h3>
      <div id="view-announcement-details">
        <div class="view-row"><span class="view-label">Subject:</span> <span id="view-subject"></span></div>
        <div class="view-row"><span class="view-label">Date:</span> <span id="view-date"></span></div>
        <div class="view-row"><span class="view-label">Message:</span> <span id="view-message"></span></div>
        <div class="view-row" id="view-image-row" style="display:none; margin-top: 1rem;">
          <span class="view-label">Image:</span><br>
          <img id="view-image" src="" alt="Announcement Image" style="max-width: 100%; border-radius: 8px; margin-top: 0.5rem;" />
        </div>
      </div>
      <form id="edit-announcement-form" style="display:none; margin-top: 1.2rem;">
        <label for="edit-subject">Subject</label>
        <input type="text" id="edit-subject" name="edit-subject" required style="width:100%; margin-bottom: 0.7rem;">
        <label for="edit-date">Date</label>
        <input type="text" id="edit-date" name="edit-date" required style="width:100%; margin-bottom: 0.7rem;" readonly>
        <label for="edit-message">Message</label>
        <textarea id="edit-message" name="edit-message" rows="4" required style="width:100%; margin-bottom: 0.7rem;"></textarea>
        <div class="modal-buttons" style="display: flex; gap: 1rem; justify-content: flex-end;">
          <button type="button" class="btn-secondary" onclick="document.getElementById('announcement-view-edit-modal').style.display='none'">Cancel</button>
          <button type="submit" class="btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Add Announcement Modal -->
  <div id="announcement-modal" class="modal" style="display:none; align-items: center; justify-content: center; position: fixed; z-index: 9999; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(44,62,80,0.18);">
    <div class="modal-content" style="background: #fff; border-radius: 14px; max-width: 540px; width: 95vw; padding: 2rem 1.5rem 1.5rem 1.5rem; position: relative; box-shadow: 0 8px 32px rgba(44,62,80,0.18); max-height: 90vh; overflow-y: auto;">
      <h3 style="margin-bottom: 1.2rem; color: #184d27; font-size: 1.2rem; font-weight: 700; text-align: center;">Add Announcement</h3>
      <form id="announcement-form">
        <label for="subject">Subject</label>
        <input type="text" id="subject" name="subject" required style="width:100%; margin-bottom: 0.2rem;">
        <div id="subject-error" style="color: #dc3545; font-size: 0.9em; margin-bottom: 0.5rem; display: none;"></div>
        <label for="recipient">To / Year Level</label>
        <select id="recipient" name="recipient" style="width:100%; margin-bottom: 0.2rem;">
          <option value="">Select Year Level and Section</option>
          <option value="All">All</option>
          <option value="Grade 7">Grade 7</option>
          <option value="Grade 8">Grade 8</option>
          <option value="Grade 9">Grade 9</option>
          <option value="Grade 10">Grade 10</option>
        </select>
        <div id="recipient-error" style="color: #dc3545; font-size: 0.9em; margin-bottom: 0.5rem; display: none;"></div>
        <label for="message">Message</label>
        <textarea id="message" name="message" rows="4" required style="width:100%; margin-bottom: 0.2rem;"></textarea>
        <div id="message-error" style="color: #dc3545; font-size: 0.9em; margin-bottom: 0.5rem; display: none;"></div>
        <label for="image">Image (optional)</label>
        <input type="file" id="image" name="image" accept="image/*" style="width:100%; margin-bottom: 0.2rem;">
        <div id="image-error" style="color: #dc3545; font-size: 0.9em; margin-bottom: 0.5rem; display: none;"></div>
        <div class="modal-buttons" style="display: flex; gap: 1rem; justify-content: flex-end;">
          <button type="button" class="btn-secondary" id="cancel-btn">Cancel</button>
          <button type="submit" class="btn-primary">Post</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    const userRole = 'admin';
    // Logout functionality
    document.querySelector('.logout-btn').addEventListener('click', function() {
      window.location.href = '../index.html';
    });
    // Modal functionality
    const modal = document.getElementById('announcement-modal');
    const addBtn = document.getElementById('add-announcement-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const announcementForm = document.getElementById('announcement-form');
    const announcementsList = document.querySelector('.announcements-list');

    // View/Edit Modal elements
    const viewEditModal = document.getElementById('announcement-view-edit-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const modalEditActions = document.getElementById('modal-edit-actions');
    const editForm = document.getElementById('edit-announcement-form');
    let editingIndex = null;

    // Announcements data array
    let announcements = [
      {
        subject: "School Reopening",
        date: "August 1, 2025",
        sender: "Admin",
        message: `Ang Sto. Niño National High School ay magsasagawa ng Early Registration simula Enero 25, 2025 hanggang Pebrero 28, 2025.\n\nMagtungo lamang sa paaralan at dalhin ang mga sumusunod na REQUIREMENTS:\n✅ PSA BIRTH CERTIFICATE (PHOTOCOPY)\n✅ COPY OF SF9 O REPORT CARD (LATEST)\n✅ BALLPEN\nPara sa pagpaparehistro:\n1. Dalhin ang mga requirement sa araw ng pagpapatala.\n2. Hanapin lamang ang mga naka-assign na focal person para maipasa ang inyong mga requirement at para makapagpatala.\n\nFocal Persons:\nMorning:\nMr. Dunstan Glorioso\nMrs. Glaiza Madridano\nAfternoon:\nMrs. Pia Shodhnani\nMr. Rolando Gading\n#EngagingtheHeartof21stCenturyLearners`,
        image: ""
      },
      {
        subject: "Official List of Grade 7 Students",
        date: "June 1, 2025",
        sender: "Admin",
        message: "Official List of Grade 7 Students",
        image: "../images/mamamo.png"
      },
      {
        subject: "IMPORTANT",
        date: "June 1, 2025",
        sender: "Sir JP",
        message: "Greetings, Admin! I have a student named James Trio. He said he already passed the soft copy of his form 138. Can you please check whether he passed it already?",
        image: ""
      }
    ];

    function formatDate(date) {
      return date.toLocaleDateString('en-US', {
        month: 'long',
        day: 'numeric',
        year: 'numeric'
      });
    }

    // Hide/show controls based on userRole
    if (userRole === 'student') {
      // Hide Add Announcement button
      if (addBtn) addBtn.style.display = 'none';
    }

    function createAnnouncementHTML(announcement, idx) {
      let preview = announcement.message;
      if (preview.length > 25) {
        preview = preview.substring(0, 25) + ' See more...';
      }
      let controls = '';
      if (userRole !== 'student') {
        controls = `<button type="button" class="view-btn">View</button><br>
          <button type="button" class="edit-btn">Edit</button><br>
          <button type="button" class="delete-btn">Delete</button>`;
      } else {
        controls = `<button type="button" class="view-btn">View</button>`;
      }
      let imageHTML = '';
      if (announcement.image) {
        imageHTML = `<div class="announcement-image"><img src="${announcement.image}" alt="Announcement Image" style="max-width: 100%; border-radius: 8px; margin: 0.5rem 0;" /></div>`;
      }
      return `
        <div class="announcement-card" data-index="${idx}">
          <div class="announcement-icons">
            <span class="card-bell">
              <svg width="28" height="28" fill="none" stroke="#f6c23e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
            </span>
          </div>
          <div class="announcement-header" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div class="announcement-subject">Subject: ${announcement.subject}</div>
              <div class="announcement-date">${announcement.date}</div>
              <div class="announcement-sender">From: ${announcement.sender}</div>
            </div>
            <div style="position: relative;">
              <button type="button" class="dots-btn" aria-label="More options">⋮</button>
              <div class="dropdown-menu" style="display: none; position: absolute; right: 0; top: 2rem;">
                ${controls}
              </div>
            </div>
          </div>
          ${imageHTML}
          <div class="announcement-message">${preview}</div>
        </div>
      `;
    }

    function renderAnnouncements() {
      announcementsList.innerHTML = announcements.map((a, i) => createAnnouncementHTML(a, i)).join('');
      // Add event listeners for all dropdowns and actions
      document.querySelectorAll('.dots-btn').forEach((btn, i) => {
        btn.onclick = function(e) {
          e.stopPropagation();
          const menu = btn.nextElementSibling;
          document.querySelectorAll('.dropdown-menu').forEach(m => { if (m !== menu) m.style.display = 'none'; });
          menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        };
      });
      document.querySelectorAll('.dropdown-menu').forEach(menu => {
        menu.onclick = e => e.stopPropagation();
      });
      document.addEventListener('click', () => {
        document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none');
      });
      document.querySelectorAll('.view-btn').forEach((btn, i) => {
        btn.onclick = function(e) {
          e.stopPropagation();
          const idx = btn.closest('.announcement-card').getAttribute('data-index');
          const a = announcements[idx];
          document.getElementById('modal-title').textContent = 'Announcement Details';
          // Show view layout, hide form
          document.getElementById('view-announcement-details').style.display = '';
          document.getElementById('edit-announcement-form').style.display = 'none';
          document.getElementById('view-subject').textContent = a.subject;
          document.getElementById('view-date').textContent = a.date;
          document.getElementById('view-message').textContent = a.message;
          const viewImageRow = document.getElementById('view-image-row');
          const viewImage = document.getElementById('view-image');
          if (a.image) {
            viewImage.src = a.image;
            viewImageRow.style.display = '';
          } else {
            viewImageRow.style.display = 'none';
          }
          viewEditModal.style.display = 'flex';
          btn.parentElement.style.display = 'none';
        };
      });
      document.querySelectorAll('.edit-btn').forEach((btn, i) => {
        btn.onclick = function(e) {
          e.stopPropagation();
          const idx = btn.closest('.announcement-card').getAttribute('data-index');
          const a = announcements[idx];
          document.getElementById('modal-title').textContent = 'Edit Announcement';
          // Show form, hide view layout
          document.getElementById('view-announcement-details').style.display = 'none';
          document.getElementById('edit-announcement-form').style.display = '';
          document.getElementById('edit-subject').value = a.subject;
          document.getElementById('edit-date').value = a.date;
          document.getElementById('edit-message').value = a.message;
          document.getElementById('edit-subject').readOnly = false;
          document.getElementById('edit-date').readOnly = true;
          document.getElementById('edit-message').readOnly = false;
          document.querySelector('#edit-announcement-form .btn-primary').style.display = '';
          editingIndex = idx;
          viewEditModal.style.display = 'flex';
          btn.parentElement.style.display = 'none';
        };
      });
      document.querySelectorAll('.delete-btn').forEach((btn, i) => {
        btn.onclick = function(e) {
          e.stopPropagation();
          const idx = btn.closest('.announcement-card').getAttribute('data-index');
          if (confirm('Are you sure you want to delete this announcement?')) {
            announcements.splice(idx, 1);
            renderAnnouncements();
          }
          btn.parentElement.style.display = 'none';
        };
      });
    }

    // Initial render
    renderAnnouncements();

    addBtn.onclick = () => { modal.style.display = 'flex'; };
    cancelBtn.onclick = closeModal;
    modal.onclick = e => { if (e.target === modal) closeModal(); };
    function closeModal() { modal.style.display = 'none'; announcementForm.reset(); }

    // View/Edit modal close
    document.getElementById('close-view-edit-modal').onclick = function() {
      document.getElementById('announcement-view-edit-modal').style.display = 'none';
    };
    window.addEventListener('click', function(event) {
      if (event.target === viewEditModal) viewEditModal.style.display = 'none';
    });

    // Add new edit form submit logic
    if (editForm) {
      editForm.onsubmit = function(e) {
        e.preventDefault();
        if (editingIndex === null) return;
        announcements[editingIndex].subject = document.getElementById('edit-subject').value;
        announcements[editingIndex].date = document.getElementById('edit-date').value;
        announcements[editingIndex].message = document.getElementById('edit-message').value;
        renderAnnouncements();
        viewEditModal.style.display = 'none';
        editingIndex = null;
      };
    }

    announcementForm.onsubmit = function(e) {
      e.preventDefault();
      let valid = true;
      // Clear previous errors
      document.getElementById('subject-error').style.display = 'none';
      document.getElementById('recipient-error').style.display = 'none';
      document.getElementById('message-error').style.display = 'none';
      document.getElementById('image-error').style.display = 'none';

      const subject = announcementForm.subject.value.trim();
      const recipient = announcementForm.recipient.value.trim();
      const message = announcementForm.message.value.trim();
      const imageInput = announcementForm.image;

      if (!subject) {
        document.getElementById('subject-error').textContent = 'Subject is required.';
        document.getElementById('subject-error').style.display = 'block';
        valid = false;
      }
      if (!recipient) {
        document.getElementById('recipient-error').textContent = 'Please select a year level or section.';
        document.getElementById('recipient-error').style.display = 'block';
        valid = false;
      }
      if (!message) {
        document.getElementById('message-error').textContent = 'Message is required.';
        document.getElementById('message-error').style.display = 'block';
        valid = false;
      }
      if (imageInput && imageInput.files && imageInput.files[0]) {
        const file = imageInput.files[0];
        if (!file.type.startsWith('image/')) {
          document.getElementById('image-error').textContent = 'Only image files are allowed.';
          document.getElementById('image-error').style.display = 'block';
          valid = false;
        }
      }
      if (!valid) return;

      // Handle image upload
      if (imageInput && imageInput.files && imageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const newAnnouncement = {
            subject: subject,
            date: formatDate(new Date()),
            sender: "Admin",
            message: message,
            image: event.target.result // Data URL
          };
          announcements.unshift(newAnnouncement);
          renderAnnouncements();
          showSuccessAndClose();
        };
        reader.readAsDataURL(imageInput.files[0]);
      } else {
        const newAnnouncement = {
          subject: subject,
          date: formatDate(new Date()),
          sender: "Admin",
          message: message,
          image: ""
        };
        announcements.unshift(newAnnouncement);
        renderAnnouncements();
        showSuccessAndClose();
      }
    };

    // Helper to show success message and close modal
    function showSuccessAndClose() {
      // Hide the form
      announcementForm.style.display = 'none';

      // Show success message inside the modal
      let modalContent = document.querySelector('#announcement-modal .modal-content');
      let successDiv = document.createElement('div');
      successDiv.className = 'success-message';
      successDiv.style.color = '#198754';
      successDiv.style.fontWeight = 'bold';
      successDiv.style.textAlign = 'center';
      successDiv.style.margin = '2rem 0';
      successDiv.textContent = 'Announcement posted successfully!';
      modalContent.appendChild(successDiv);

      // After 1.5s, close modal, reset form, and restore form display
      setTimeout(() => {
        document.getElementById('announcement-modal').style.display = 'none';
        announcementForm.reset();
        successDiv.remove();
        announcementForm.style.display = '';
      }, 1500);
    }

    document.addEventListener('DOMContentLoaded', function() {
      var closeBtn = document.getElementById('close-view-edit-modal');
      var modal = document.getElementById('announcement-view-edit-modal');
      if (closeBtn && modal) {
        closeBtn.onclick = function() {
          modal.style.display = 'none';
        };
      }
      // Use addEventListener to avoid overwriting other handlers
      window.addEventListener('click', function(event) {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
